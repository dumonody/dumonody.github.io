---
title: 网络编程
---
### IP
```java
import java.net.InetAddress;
import java.net.UnknownHostException;

public class IPDemo {

	public static void main(String[] args) {

		try {
			// 获取本地主机地址对象：
			InetAddress ip = InetAddress.getLocalHost();
			// 获取主机地址：
			System.out.println(ip.getHostAddress());	// 192.168.0.134
			// 获取主机名称：
			System.out.println(ip.getHostName());	// czkct-PC
			
			// 获取其它主机地址
			InetAddress ip2 = InetAddress.getByName("www.baidu.com");
			System.out.println(ip2.getHostAddress());	// 14.215.177.37
			System.out.println(ip2.getHostName());		// www.baidu.com
			
			// 有一种情况要注意：若getHostName()的返回值与geHostAddress()返回值都是IP地址
			// 原因是：主机名与主机地址之间有对应关系，想要获取主机名，就要先解析主机地址
			// 所以：当主机地址解析不成功时，getHostName()就直接返回主机地址，而不是主机名
			
		} catch (UnknownHostException e) {
			e.printStackTrace();
		}
	}

}
```
### UDP
#### 使用UDP协议发送数据
```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.SocketException;
import java.net.UnknownHostException;

public class UDPSend {

	public static void main(String[] args) {
		try {
			// 1. 需要先建立udp的socket。它具备发送或者接受功能
			DatagramSocket ds = new DatagramSocket();
			
			// 2. 将数据封装到数据包中。数据包对象是DatagramPacket
			String text = "发送的内容！";
			byte[] buf = text.getBytes();	// 将数据转换成字节数组
				// 将字节数组封装到数据包中
			DatagramPacket dp = new DatagramPacket(buf, buf.length, InetAddress.getByName("192.168.0.134"), 10000);
			
			// 3. 使用socket对象的send方法将数据包发送出去
			ds.send(dp);
			
			// 4. 关闭资源
			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```
#### 使用UDP协议接收数据
```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.SocketException;

public class UDPReceive {

	public static void main(String[] args) {

		try {
			// 1. 需要先建立udp的socket。它具备发送或者接受功能
				// 注意：一定要明确端口，否则无法接受到发送端向指定端口发送的数据
			DatagramSocket ds = new DatagramSocket(10000);
			
			// 2.定义数据包, 接收数据
			byte[] buf = new byte[1024];
			DatagramPacket dp = new DatagramPacket(buf, buf.length);
			ds.receive(dp);	// 此方法会导致当前线程阻塞
			
			// 3.通过数据包对象获取数据包的内容，发送端的ip。发送端的端口，发送端发送来的数据
			String ip = dp.getAddress().getHostAddress();
			int port = dp.getPort();
			String text = new String(dp.getData(), 0, dp.getLength());
			// 打印获取的数据
			System.out.println(text);
			
			// 4.关闭资源
			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```

**注意：接收端的端口必须与发送端指定发送的端口一致**

#### UDP发送接收数据加强
**达到的效果：发送端可以用发送键盘录入的多条数据，以及接收端可以接收多条数据**
```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.SocketException;
import java.net.UnknownHostException;
import java.util.Scanner;

public class UDPSend2 {

	public static void main(String[] args) {
		try {
			DatagramSocket ds = new DatagramSocket();
			Scanner sc = new Scanner(System.in);
			
			String text = null;
			while((text = sc.nextLine()) != null)
			{
				byte[] buf = text.getBytes();
				DatagramPacket dp = new DatagramPacket(buf, buf.length, InetAddress.getByName("192.168.0.134"), 10001);
				ds.send(dp);
				if(text.equals("over"))
				{
					break;
				}
			}
			
			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

}
```
```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.SocketException;

public class UDPReceive2 {

	public static void main(String[] args) {

		try {
			DatagramSocket ds = new DatagramSocket(10001);
			
			while(true)
			{
				byte[] buf = new byte[1024];
				DatagramPacket dp = new DatagramPacket(buf, buf.length);
				ds.receive(dp);
				
				String ip = dp.getAddress().getHostAddress();
				int port = dp.getPort();
				String text = new String(dp.getData(), 0, dp.getLength());
				System.out.println(text);
				if(text.equals("over"))
				{
					break;
				}
			}
			
			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
```
#### UDP群聊实现
- 通过UDP实现群聊（发送与接收同体）
-- **技术分析：**
-- 1、既有发送功能，又有接收功能，意味着需要使用多线程
-- 2、注意使用255广播地址
-- --例如：下面代码中如果使用192.168.0.134, 则表示发送内容给192.168.0.134这台主机
-- --但是换成ip：192.168.0.255, 则表示发送内容给192.168.0.0~192.168.0.254的所有主机
```java
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.SocketException;
import java.net.UnknownHostException;
import java.util.Scanner;

public class UDPChat {

	public static void main(String[] args) throws Exception {

		
		// 同时拥有收发功能，则应该有两个Socket，一个用于发送，一个用于接收
		DatagramSocket sendSocket = new DatagramSocket();
		DatagramSocket receiveSocket = new DatagramSocket(10002);
		
		// 创建任务对象
		Send send = new Send(sendSocket);
		Receive receive = new Receive(receiveSocket);
		
		// 创建线程并执行
		Thread sendT = new Thread(send);
		Thread receiveT = new Thread(receive);
		sendT.start();
		receiveT.start();
		
	}

}
/**
 * 发送任务类
 * @author Pro.Du
 *
 */
class Send implements Runnable{

	private DatagramSocket ds = null;
	
	public Send(DatagramSocket ds)
	{
		this.ds = ds;
	}
	
	@Override
	public void run() {
		
		try {
			Scanner sc = new Scanner(System.in);
			
			String text = null;
			while((text = sc.nextLine()) != null)
			{
				byte[] buf = text.getBytes();
				DatagramPacket dp = new DatagramPacket(buf, buf.length, InetAddress.getByName("192.168.0.255"), 10002);
				ds.send(dp);
				if(text.equals("over"))
				{
					break;
				}
			}
			
			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}

/**
 * 接收任务类
 * @author Pro.Du
 *
 */
class Receive implements Runnable{

private DatagramSocket ds = null;
	
	public Receive(DatagramSocket ds)
	{
		this.ds = ds;
	}
	@Override
	public void run() {
		try {
			while(true)
			{
				byte[] buf = new byte[1024];
				DatagramPacket dp = new DatagramPacket(buf, buf.length);
				ds.receive(dp);
				
				String ip = dp.getAddress().getHostAddress();
				int port = dp.getPort();
				String text = new String(dp.getData(), 0, dp.getLength());
				System.out.println("IP:" + ip + ":" + port + " -> " + text);
				if(text.equals("over"))
				{
					System.out.println("IP:" + ip + ":" + port + " ...... 离开聊天室" );
//					break;
				}
			}
			
//			ds.close();
			
		} catch (SocketException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
}
```